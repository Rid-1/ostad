function getValWithKeys(t,a,e=""){var d=t;if(Array.isArray(a))for(var n=0;n<a.length&&("number"!=typeof e||n!==e);n++)"object"==typeof d&&(d=d[a[n]]);return d}function objectDepth(t){var a;return Array.isArray(t)?a=t:"object"==typeof t&&(a=Object.keys(t).map(a=>t[a])),a?Math.max.apply(0,a.map(objectDepth))+1:1}function validURL(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)}$(".file-downloader").each(function(t){var a=$(this);$.ajax({url:a.attr("data-json-url"),cache:!1}).done(function(t){for(var e=a.attr("data-options-title").split(","),d="",n=objectDepth(t)-1,i=0;i<n;i++){if(d+='<div class="option">',d+="<span>"+e[i]+"</span>",d+='<select name="option_'+i+'" data-level="'+i+'" data-depth="'+n+'">',d+='<option value=""></option>',0==i)for(const[a,e]of Object.entries(t))d+='<option value="'+a+'">'+a+"</option>";d+="</select>",d+="</div>"}void 0!==a.attr("data-redirect-page-url")?(d+='<form action="'+a.attr("data-redirect-page-url")+'" method="get" target="_blank">',d+='<input name="url" type="hidden" name="url"/>',d+='<div class="buttons">',d+='<button class="download-btn" type="submit" disabled="disabled">تحميل</button>',d+='<a class="cancel-btn" href="javascript:void(0)">إلغاء</a>',d+="</div>",d+="</form>"):(d+='<input name="url" type="hidden" name="url"/>',d+='<div class="buttons">',d+='<a class="download-btn" href="javascript:void(0)">تحميل</a>',d+='<a class="cancel-btn" href="javascript:void(0)">إلغاء</a>',d+="</div>"),d+="<textarea>"+JSON.stringify(t)+"</textarea>",a.attr("data-loaded","true"),a.html(d)})}),$(document).on("change",".file-downloader select",function(){var t=$(this),a=[],e=t.parents(".file-downloader"),d=t.attr("data-level"),n=t.val(),i=JSON.parse(e.find("textarea").val());void 0!==e.attr("data-redirect-page-url")&&e.attr("data-redirect-page-url");$(e).find("select").each(function(){""==$(this).val()||$(this).attr("data-level")>d||a.push($(this).val())}),e.find("select").each(function(){$(this).attr("data-level")>d&&$(this).html('<option value=""></option>')});getValWithKeys(i,a);var o=getValWithKeys(i,a,d);if("object"==typeof o){var r=parseInt(d)+1,l='<option value=""></option>';if(""!==n)for(const[t,a]of Object.entries(o))l+='<option value="'+t+'">'+t+"</option>";e.find('select[data-level="'+r+'"]').html(l),void 0!==e.attr("data-redirect-page-url")?e.find(".download-btn").attr("disabled","disabled"):e.find(".download-btn").attr("href","javascript:void(0)").attr("target",""),e.find(".download-btn").removeClass("active")}else validURL(o)&&(void 0!==e.attr("data-redirect-page-url")?e.find(".download-btn").removeAttr("disabled").removeAttr("href"):e.find(".download-btn").attr("href",o).attr("target","_blank"),e.find("input").val(o),e.find(".download-btn").addClass("active"))}),$(document).on("click",".file-downloader .cancel-btn",function(){var t=$(this).parents(".file-downloader");t.find("select").each(function(){"0"==$(this).attr("data-level")?$(this).val(""):$(this).html('<option value=""></option>'),t.find(".download-btn").attr("href","javascript:void(0)").attr("target",""),t.find(".download-btn").removeClass("active")}),void 0!==t.attr("data-redirect-page-url")?t.find(".download-btn").attr("disabled","disabled"):t.find(".download-btn").attr("href","javascript:void(0)").attr("target",""),t.find(".download-btn").removeClass("active")});
