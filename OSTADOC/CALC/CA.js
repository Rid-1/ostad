function downloadPng(t){var e=document.createElement("a");document.body.appendChild(e),e.setAttribute("href",t),e.setAttribute("download","result.png"),e.click()}function calcRes(t){var e=t;return isNaN(t)||""==t?(alert("المرجو إدخال النقط لحساب المعدل العام!"),""):e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]}!function(t){"use strict";var r,e,l={escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:p,mimeType:function(t){var e,n,e="application/font-woff",n="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:n,jpeg:n,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}[p(t).toLowerCase()]||""},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):(a=e,new Promise(function(t){for(var e=window.atob(a.toDataURL().split(",")[1]),n=e.length,r=new Uint8Array(n),o=0;o<n;o++)r[o]=e.charCodeAt(o);t(new Blob([r],{type:"image/png"}))}));var a},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=e,o.href=t,o.href},getAndEncode:function(a){return c.impl.options.cacheBust&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime()),new Promise(function(n){var t,e,r=new XMLHttpRequest;function o(t){console.error(t),n("")}r.onreadystatechange=function(){var e;4===r.readyState&&(200===r.status?((e=new FileReader).onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(r.response)):t?n(t):o("cannot fetch resource: "+a+", status: "+r.status))},r.ontimeout=function(){t?n(t):o("timeout of 30000ms occured while fetching resource: "+a)},r.responseType="blob",r.timeout=3e4,r.open("GET",a,!0),r.send(),c.impl.options.imagePlaceholder&&(e=c.impl.options.imagePlaceholder.split(/,/))&&e[1]&&(t=e[1])})},uid:function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++},delay:function(n){return function(e){return new Promise(function(t){setTimeout(function(){t(e)},n)})}},asArray:function(t){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){t(n)},n.onerror=e,n.src=r})},width:function(t){var e=m(t,"border-left-width"),n=m(t,"border-right-width");return t.scrollWidth+e+n},height:function(t){var e=m(t,"border-top-width"),n=m(t,"border-bottom-width");return t.scrollHeight+e+n}},o={inlineAll:function(e,r,o){return f(e)?Promise.resolve(e).then(d).then(function(t){var n=Promise.resolve(e);return t.forEach(function(e){n=n.then(function(t){return h(t,e,r,o)})}),n}):Promise.resolve(e)},shouldProcess:f,impl:{readUrls:d,inline:h}},a={resolveAll:function(){return s(document).then(function(t){return Promise.all(t.map(function(t){return t.resolve()}))}).then(function(t){return t.join("\n")})},impl:{readAll:s}},n={inlineAll:function t(e){return e instanceof Element?((r=(n=e).style.getPropertyValue("background"))?o.inlineAll(r).then(function(t){n.style.setProperty("background",t,n.style.getPropertyPriority("background"))}).then(function(){return n}):Promise.resolve(n)).then(function(){return e instanceof HTMLImageElement?u(e).inline():Promise.all(l.asArray(e.childNodes).map(t))}):Promise.resolve(e);var n,r},impl:{newImage:u}},i={imagePlaceholder:void(e=0),cacheBust:!(r=/url\(['"]?([^'"]+?)['"]?\)/g)},c={toSvg:g,toPng:function(t,e){return v(t,e||{}).then(function(t){return t.toDataURL()})},toJpeg:function(t,e){return v(t,e=e||{}).then(function(t){return t.toDataURL("image/jpeg",e.quality||1)})},toBlob:function(t,e){return v(t,e||{}).then(l.canvasToBlob)},toPixelData:function(e,t){return v(e,t||{}).then(function(t){return t.getContext("2d").getImageData(0,0,l.width(e),l.height(e)).data})},impl:{fontFaces:a,images:n,util:l,inliner:o,options:{}}};function u(r){return{inline:function(t){return l.isDataUrl(r.src)?Promise.resolve():Promise.resolve(r.src).then(t||l.getAndEncode).then(function(t){return l.dataAsUrl(t,l.mimeType(r.src))}).then(function(n){return new Promise(function(t,e){r.onload=t,r.onerror=e,r.src=n})})}}}function s(){return Promise.resolve(l.asArray(document.styleSheets)).then(function(t){var n=[];return t.forEach(function(e){try{l.asArray(e.cssRules||[]).forEach(n.push.bind(n))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),n}).then(function(t){return t.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return o.shouldProcess(t.style.getPropertyValue("src"))})}).then(function(t){return t.map(e)});function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return o.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}function f(t){return-1!==t.search(r)}function d(t){for(var e,n=[];null!==(e=r.exec(t));)n.push(e[1]);return n.filter(function(t){return!l.isDataUrl(t)})}function h(e,n,r,t){return Promise.resolve(n).then(function(t){return r?l.resolveUrl(t,r):t}).then(t||l.getAndEncode).then(function(t){return l.dataAsUrl(t,l.mimeType(n))}).then(function(t){return e.replace(new RegExp("(url\\(['\"]?)("+l.escape(n)+")(['\"]?\\))","g"),"$1"+t+"$3")})}function p(t){t=/\.([^\.\/]*?)$/g.exec(t);return t?t[1]:""}function m(t,e){e=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(e.replace("px",""))}function g(r,o){return t=o=o||{},c.impl.options.imagePlaceholder=(void 0===t.imagePlaceholder?i:t).imagePlaceholder,c.impl.options.cacheBust=(void 0===t.cacheBust?i:t).cacheBust,Promise.resolve(r).then(function(t){return u=t,i=o.filter,Promise.resolve(u).then(function(t){return t instanceof HTMLCanvasElement?l.makeImage(t.toDataURL()):t.cloneNode(!1)}).then(function(t){return e=t,n=i,0===(t=u.childNodes).length?Promise.resolve(e):(r=e,t=l.asArray(t),o=n,a=Promise.resolve(),t.forEach(function(t){a=a.then(function(){return function o(e,n,t){if(!t&&n&&!n(e))return Promise.resolve();return Promise.resolve(e).then(r).then(function(t){return a(e,t,n)}).then(function(t){return i(e,t)});function r(t){return t instanceof HTMLCanvasElement?l.makeImage(t.toDataURL()):t.cloneNode(!1)}function a(t,e,n){var t=t.childNodes;return 0===t.length?Promise.resolve(e):function(e,t,n){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return o(t,n)}).then(function(t){t&&e.appendChild(t)})}),r}(e,l.asArray(t),n).then(function(){return e})}function i(i,c){return c instanceof Element?Promise.resolve().then(function(){var t,e,n,r;t=window.getComputedStyle(i),e=c.style,t.cssText?e.cssText=t.cssText:(n=t,r=e,l.asArray(n).forEach(function(t){r.setProperty(t,n.getPropertyValue(t),n.getPropertyPriority(t))}))}).then(function(){[":before",":after"].forEach(function(t){!function(t){var e,n,r,o=window.getComputedStyle(i,t),a=o.getPropertyValue("content");""!==a&&"none"!==a&&(n=l.uid(),c.className=c.className+" "+n,(e=document.createElement("style")).appendChild((a="."+n+":"+t,n=(n=o).cssText?(o=(t=n).getPropertyValue("content"),t.cssText+" content: "+o+";"):(r=n,l.asArray(r).map(function(t){return t+": "+r.getPropertyValue(t)+(r.getPropertyPriority(t)?" !important":"")}).join("; ")+";"),document.createTextNode(a+"{"+n+"}"))),c.appendChild(e))}(t)})}).then(function(){i instanceof HTMLTextAreaElement&&(c.innerHTML=i.value),i instanceof HTMLInputElement&&c.setAttribute("value",i.value)}).then(function(){c instanceof SVGElement&&(c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c instanceof SVGRectElement&&["width","height"].forEach(function(t){var e=c.getAttribute(t);e&&c.style.setProperty(t,e)}))}).then(function(){return c}):c}}(t,o)}).then(function(t){t&&r.appendChild(t)})}),a.then(function(){return e}));var e,n,r,o,a}).then(function(t){return i=u,(c=t)instanceof Element?Promise.resolve().then(function(){var e,n,t=window.getComputedStyle(i),r=c.style;t.cssText?r.cssText=t.cssText:(e=t,n=r,l.asArray(e).forEach(function(t){n.setProperty(t,e.getPropertyValue(t),e.getPropertyPriority(t))}))}).then(function(){[":before",":after"].forEach(function(t){var e,n,r,o,a;e=t,o=window.getComputedStyle(i,e),""!==(a=o.getPropertyValue("content"))&&"none"!==a&&(n=l.uid(),c.className=c.className+" "+n,(t=document.createElement("style")).appendChild((a="."+n+":"+e,n=(n=o).cssText?(o=(e=n).getPropertyValue("content"),e.cssText+" content: "+o+";"):(r=n,l.asArray(r).map(function(t){return t+": "+r.getPropertyValue(t)+(r.getPropertyPriority(t)?" !important":"")}).join("; ")+";"),document.createTextNode(a+"{"+n+"}"))),c.appendChild(t))})}).then(function(){i instanceof HTMLTextAreaElement&&(c.innerHTML=i.value),i instanceof HTMLInputElement&&c.setAttribute("value",i.value)}).then(function(){c instanceof SVGElement&&(c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c instanceof SVGRectElement&&["width","height"].forEach(function(t){var e=c.getAttribute(t);e&&c.style.setProperty(t,e)}))}).then(function(){return c}):c;var i,c});var u,i}).then(y).then(w).then(function(e){return o.bgcolor&&(e.style.backgroundColor=o.bgcolor),o.width&&(e.style.width=o.width+"px"),o.height&&(e.style.height=o.height+"px"),o.style&&Object.keys(o.style).forEach(function(t){e.style[t]=o.style[t]}),e}).then(function(t){return t=t,e=o.width||l.width(r),n=o.height||l.height(r),Promise.resolve(t).then(function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)}).then(l.escapeXhtml).then(function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"}).then(function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+n+'">'+t+"</svg>"}).then(function(t){return"data:image/svg+xml;charset=utf-8,"+t});var e,n});var t}function v(r,o){return g(r,o).then(l.makeImage).then(l.delay(100)).then(function(t){var e,n,n=(e=r,(n=document.createElement("canvas")).width=o.width||l.width(e),n.height=o.height||l.height(e),o.bgcolor&&((e=n.getContext("2d")).fillStyle=o.bgcolor,e.fillRect(0,0,n.width,n.height)),n);return n.getContext("2d").drawImage(t,0,0),n})}function y(n){return a.resolveAll().then(function(t){var e=document.createElement("style");return n.appendChild(e),e.appendChild(document.createTextNode(t)),n})}function w(t){return n.inlineAll(t).then(function(){return t})}"undefined"!=typeof module?module.exports=c:t.domtoimage=c}(this),$(document).ready(function(){var e="";e+='<div class="single-subject">',e+='<input type="text" class="s-n" placeholder="اسم المادة"/>',e+='<input type="number" class="s-p" min="0" max="%s-p-max%" placeholder="النقطة"/>',e+='<input type="number" class="s-x" min="1" max="%s-x-max%" placeholder="المعامل"/>',e+="</div>",$(".ostad-result-calculator").each(function(){var t="";t+='<div class="capture-area">',t+='<div class="subjects">',t+=e.replace("%s-p-max%",$(this).attr("data-s-p-max")).replace("%s-x-max%",$(this).attr("data-s-x-max")),t+="</div>",t+='<div class="result"></div>',t+="<p>تم حساب هذه النتيجة بواسطة: https://doc.ostad.ma</p>",t+="</div>",t+='<div class="footer-btns">',t+='<button type="button" class="new-subject">إضافة مادة</button>',t+='<button type="button" class="calculate">حساب النتيجة</button>',t+='<button type="button" class="capture">تحميل</button>',t+='<button type="button" class="cancel">إلغاء</button>',t+="</div>",$(this).html(t)}),$(".ostad-result-calculator").on("click",".new-subject",function(){var t=$(this).parents(".ostad-result-calculator");t.find(".subjects").append(e.replace("%s-p-max%",t.attr("data-s-p-max")).replace("%s-x-max%",t.attr("data-s-x-max")))}),$(".ostad-result-calculator").on("click",".calculate",function(){var t=$(this).parents(".ostad-result-calculator"),e=t.find(".s-p"),n=t.find(".s-x"),r=0,o=0;e.each(function(t,e){t=""==$(n[t]).val()?1:parseInt($(n[t]).val());""!==$(this).val()&&(r+=parseFloat($(this).val())*t,o+=parseInt(t))});e=calcRes(r/o);""!==e&&(t.addClass("calculated"),t.find(".result").html(t.attr("data-result-text")+""+e))}),$(".ostad-result-calculator").on("click",".capture",function(){domtoimage.toPng($(".ostad-result-calculator .capture-area")[0],{quality:1}).then(function(t){downloadPng(t)})}),$(".ostad-result-calculator").on("click",".cancel",function(){var t=$(this).parents(".ostad-result-calculator");t.find(".subjects").html(e.replace("%s-p-max%",t.attr("data-s-p-max")).replace("%s-x-max%",t.attr("data-s-x-max"))),t.find(".result").html(""),t.removeClass("calculated")}),$(".ostad-year-result-calculator").each(function(){for(var t="",e=JSON.parse($(this).find('textarea').val().replaceAll('“', '"').replaceAll('”', '"').replaceAll('″', '"')),n=0;n<e.length;n++){var r,o=e[n].field;e[n].multiply_by;for(r in o)t+='<input type="number" min="0" max="'+$(this).attr("data-p-max")+'" class="'+r+'" placeholder="'+o[r]+'"/>'}t+='<div class="result"></div>',t+='<div class="footer-btns">',t+='<button type="button" class="calculate">حساب المعدل العام</button>',t+='<button type="button" class="cancel">إلغاء</button>',t+="</div>",$(this).prepend(t)}),$(".ostad-year-result-calculator").on("click",".calculate",function(){for(var t=$(this).parents(".ostad-year-result-calculator"),e=JSON.parse(t.find('textarea').val().replaceAll('“', '"').replaceAll('”', '"').replaceAll('″', '"')),n=0,r=0;r<e.length;r++){var o,a=e[r].field,i=e[r].multiply_by,c=0,u=0;for(o in a){var l=t.find("."+o);c+=parseFloat(l.val()),u++}n+=c/u*i}var s=calcRes(n);""!==s&&(t.addClass("calculated"),t.find(".result").html(t.attr("data-result-text")+""+s))}),$(".ostad-year-result-calculator").on("click",".cancel",function(){var t=$(this).parents(".ostad-year-result-calculator");t.find("input").each(function(){$(this).val("")}),t.find(".result").html(""),t.removeClass("calculated")})});
